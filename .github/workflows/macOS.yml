name: macOS
on: [workflow_dispatch]
jobs:
  build:
    runs-on: macos-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: Checkout tools repo
        uses: actions/checkout@v2
        with:
          repository: HydrologicEngineeringCenter/dss-test-data
          path: dss-test-data

      - name: link gfortran
        run: |
          ln -s /usr/local/bin/gfortran-9 /usr/local/bin/gfortran
          gfortran -v

      - name: install openjdk
        run: |
          brew install openjdk@11

      - name: build main library
        run: |
          cd heclib
          make
        env:
          JAVA_HOME: /usr/local/opt/openjdk@11/libexec/openjdk.jdk/Contents/Home
          GFORTRAN_PATH: /usr/local/opt/gcc@9/lib/gcc/9/

      - name: run C test
        run: |
          cd ../test/C
          chmod +x unix_test
          ./unix_test
